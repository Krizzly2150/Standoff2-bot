name: Run Telegram Bot 24/7

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 */4 * * *'  # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '6.0.x'

    - name: Restore dependencies
      run: dotnet restore

    - name: Build
      run: dotnet build --no-restore

    - name: Run Telegram Bot
      run: |
        echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
        nohup dotnet run &
        sleep 300  # –ñ–¥–µ–º 5 –º–∏–Ω—É—Ç —á—Ç–æ–±—ã –±–æ—Ç –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
        if ps aux | grep -q "[d]otnet run"; then
          echo "‚úÖ –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω"
        else
          echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"
          exit 1
        fi